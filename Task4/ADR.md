### <a name="_b7urdng99y53"></a>**Название задачи:** Передача ставок в кол-центр
### <a name="_hjk0fkfyohdk"></a>**Автор:** Шабашный Виталий
### <a name="_uanumrh8zrui"></a>**Дата:** 23.04.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**                                        |**Описание**                                                                             |
| UC1 | Клиент, Сайт                   |Клиент подает заявку на депозит через сайт          |1. Клиент заходит на сайт, просматривает список депозитов с актуальными ставками         |
|     | Клиент, Сайт                   |                                                    |2. Клиент вводит ФИО и номер телефона и оставляет заявку на депозит                      |
|     | Сайт, Кол-центр                |                                                    |3. Сайт отправляет информацию о созданной заявки в систему кол-центра                    |
| UC2 | Оператор, Кол-центр            |Оператор кол-центра обрабатывает заявки             |1. Оператор в системе кол-центра обрабатывает новую заявку                               |
|     |                                |                                                    |2. Оператор видит актуальные ставки в совей системе                                      |
| UC5 | Менеджер, АБС                  |Менеджер ведет учет ставок                          |1. Менеджеры ведут учет ставок в системе АБС                                             |
|     | АБС, Интернет-банк             |                                                    |2. АБС отправляет рассчитанные ставки в систему интернет-банка                           |
|     | АБС, Кол-центр                 |                                                    |3. АБС отправляет рассчитанные ставки в кол-центр                                        |
|     | АБС, Партнерский кол-центр     |                                                    |4. АБС отправляет рассчитанные ставки в партнерский кол-центр                            |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

|**№**|**Требование**                                                        |
| 1   | Данные в кол-центре и партнерском кол-центре должны быть консистентны|
| 2   | Использование существующих технологий (MS SQL, Oracle, .NET, Java)   |
| 3   | Kafka для асинхронной интеграции                                     |
| 4   | Кол-центр может приниматься данные по REST или Kafka (нет информации)|
| 5   | Партнерский кол-центр может приниматься только файлы                 |

### <a name="_qmphm5d6rvi3"></a>**Решение**
Диаграмма контекста
 [Ссылка на схему](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task4/Context_Diagram.drawio.png)

Диаграмма контейнеров сервиса передачи ставок
 [Ссылка на схему](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task4/Container_Diagram.drawio.png)


Описание решения:

 Для реализации задачи передачи ставок в кол-центр предлагается следующее решение: микросервис по работе со ставками уже отправляет ставки в Kafka для их последующей обработки системами интернет-банка и сайта, здесь ничего дополнительно делать не надо. Для того чтобы передать ставки и кол-центр и партнерский кол-центр и обеспечить согласованность данных необходимо разработать отдельный сервис. Данный сервис будет получать данные из имеющейся очереди Kafka и сохранять их в своей БД. После сохранения данных, сервис будет отправлять данные в кол-центр с помощью REST API или другим способом, которым система способна их принять. Для партнерского кол-центра сервис будет формировать файлы в необходимом формате и складывать их в хранилище из которого партнерский кол-центр способен их принять. В случае отказа на стороне кол-центра, сервис не должен создавать файл со ставками. Проверить доставку на стороне партнерского кол-центра не представляется возможным, поэтому считаем что проблем на данной стороне нет, если удалось создать файл. В случае ошибки на какой-либо из сторон сервис должен будет выполнить повторную отправку данных через некоторое время. Сервис реализуем с использованием имеющихся компетенций (ASP.NET, MSSQL) Добавляем логирование, мониторинг и уведомления об ошибках.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Альтернативным решением была бы прямая передача ставок в системы кол-центра из микросервиса управления ставками. Но данный сервис уже осуществляет отправку в Kafka, которая является более надежным транспортом и не должен реализовывать функциональность, которая выходит за его пределы ответственности. 

**Недостатки, ограничения, риски**

 - Партнерский кол-центр может не забирать данные из файла или обрабатывать их с ошибкой. Повлиять на это не представляется возможным
 - Новый сервис с БД потребует дополнительных серверных мощностей
 - В случае падения сервиса, ни одна из систем кол-центров не получит новых ставок

 **Список крупных задач**

 Список задач описан в файле Tasks.md 

 [Ссылка на файл](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task4/Tasks.md)

 **RoadMap**

 [Ссылка на схему](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task4/RoadMap_bank_Standart.drawio.png)