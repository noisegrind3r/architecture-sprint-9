### <a name="_b7urdng99y53"></a>**Название задачи:** Открытие депозитов онлайн
### <a name="_hjk0fkfyohdk"></a>**Автор:** Шабашный Виталий
### <a name="_uanumrh8zrui"></a>**Дата:** 22.04.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**                                        |**Описание**                                                                             |
| UC1 | Клиент, Сайт                   |Клиент подает заявку на депозит через сайт          |1. Клиент заходит на сайт, просматривает список депозитов с актуальными ставками         |
|     | Клиент, Сайт                   |                                                    |2. Клиент вводит ФИО и номер телефона и оставляет заявку на депозит                      |
|     | Сайт, Кол-центр                |                                                    |3. Сайт отправляет информацию о созданной заявки в систему кол-центра                    |
| UC2 | Оператор, Кол-центр            |Оператор кол-центра обрабатывает заявки             |1. Оператор в системе кол-центра обрабатывает новую заявку                               |
| UC3 | Клиент, Интернет-банк          |Клиент подает заявку на депозит через интернет-банк |1. Клиент заходит в интернет банк, просматривает список депозитов с актуальными ставками |
|     | Клиент, Интернет-банк          |                                                    |2. Клиент видит персонализированные ставки                                               |
|     | Клиент, Интернет-банк          |                                                    |3. Клиент указывает счет и сумму депозита и оставляет заявку на депозит                  |
|     | Интернет-банк, СМС-шлюз        |                                                    |4. Интернет-банк отправляет SMS-уведомление через СМС-шлюз                               |
|     | Клиент, Интернет-банк          |                                                    |5. Клиент подтверждает депозит через SMS-уведомление                                     |
|     | Интернет-банк, АБС             |                                                    |6. Интернет-банк отправляет информацию о созданной заявки в систему АБС                  |
| UC4 | Менеджер, АБС                  |Менеджер бэк-офиса обрабатывает заявки              |1. Менеджер в системе АБС обрабатывает новую заявку                                      |
|     | АБС, СМС-шлюз                  |                                                    |2. Система АБС отправляет уведомление через СМС-шлюз                                     |
|     | Клиент                         |                                                    |3. Клиент получает уведомление о статусе заявки                                          |
| UC5 | Менеджер, АБС                  |Менеджер ведет учет ставок                          |1. Менеджеры ведут учет ставок в системе АБС                                             |
|     | АБС, Интернет-банк             |Менеджер ведет учет ставок                          |2. АБС отправляет рассчитанные ставки в систему интернет-банка                           |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

|**№**|**Требование**                                                      |
| 1   | Отклик интерфейса < 500 мс                                         |
| 2   | Доступность 99.9% (24/7)                                           |
| 3   | Автоматическое переключение на резервный ЦОД при сбое              |
| 4   | Горизонтальное масштабирование интернет-банка                      |
| 5   | Загрузка справочников < 300 мс                                     |
| 6   | Использование существующих технологий (MS SQL, Oracle, .NET, Java) |
| 7   | Kafka для асинхронной интеграции (вместо прямых вызовов АБС)       |
| 8   | Шифрование чувствительных данных при передаче                      |
| 10  | Возможность перевода интернет-банка на микросервисы                 |
| 11  | Кеширование ставок (Redis) для снижения нагрузки на АБС            |
| 12  | Логирование всех действий для аудита                               |
| 13  | Мониторинг нагрузки на АБС в реальном времени                      |

### <a name="_qmphm5d6rvi3"></a>**Решение**
Диаграмма контекста
 [Ссылка на схему](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task3/Context_Diagram.drawio.png)

Диаграмма контейнеров системы ABS
 [Ссылка на схему](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task3/ABS_Container_Diagram.drawio.png)

Диаграмма контейнеров системы интернет-банка
 [Ссылка на схему](https://github.com/noisegrind3r/architecture-sprint-9/blob/sprint_9/Task3/InternetBank_Container_Diagram.drawio.png)

Описание решения:

 Для реализации задачи открытия депозита предлагается реализовать следующие доработки:
  - Создать новый микросервис для работы с депозитами в системе Интернет-банка. Использовать тот же стек, что и в основной системе (ASP.NET, MS SQL). Фронтенд остается прежним, но добавляется API Gateway для маршрутизации запросов. Для микросервиса депозитов используется отдельная БД. Интеграция с системой АБС будет осуществляться с помощью брокера сообщений Kafka. В случае проблем с производительностью можно реализовать горизонтальное масштабирование как микросервиса депозитов, так и основной системы интернет-банка.
  - На стороне АБС создать отдельный микросервис для управления ставками и обмена данными с Kafka (так как основная система не поддерживает брокер сообщений). Фронтенд часть оставить на стороне десктоп клиента и осуществлять взаимодействие с новым микросервисом через REST-запросы. Для того, чтобы снизить нагрузку на БД АБС предлагается использовать репликацию. Микросервис будет работать со своим инстансом БД, не добавляя нагрузку на основной инстанс. В дальнейшем, можно осуществить миграцию системы АБС на клиент-серверную модель с микросервисами и избавится от реплики БД.
  - На стороне сайта потребуется также создать отдельный сервис, который будет получать информацию по ставками через Kafka и передавать данные по заявкам в систему кол-центра или использовать имеющийся бэкенд (из описания задания не очень понятно возможно ли это) 
  - Необходимо добавить систему мониторнинга и логирования, чтобы заявки клиентов не терялись на каком-либо этапе

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Альтернативным решением была бы прямая интеграция интернет-банка и системы АБС, что позволило бы реализовать проект в более сжатые сроки, но несло повышенные риски проблем с производительностью. Также, на этапе MVP можно было оставить ведение ставок в XLS-файле, но данное решение несет множество проблем с занесением ставок в сервисы интернет-банка и сайта, что потребовало создание интерфейсов для менеджеров

**Недостатки, ограничения, риски**

 - Масштабирование системы АБС из-за десктоп-архитектуры сложно осуществимо. 
 - Репликация БД АБС потребует дополнительных серверных мощностей
 - Ядро системы интернет-банка привязано к подрядчику. Возможны сложности, если придется вносить изменения
 - Единая точка отказа в виде системы АБС: заявки перестанут обрабатываться и актуальные ставки обновляться в клиентских приложениях. Крайне важен мониторинг и оповещения